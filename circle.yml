

# Add some environment variables
machine:
    environment:
            COVERALLS_REPO_TOKEN: uhH9cjNDKk7BZkvkAJFl8NSvcoqVDCyAf
    java:
        version: oraclejdk8
dependencies:
  pre:
    - echo y | android update sdk --no-ui --all --filter "tools"
    - echo y | android update sdk --no-ui --all --filter "build-tools-23.0.2"

test:
  override:
    - ./gradlew test -PdisablePreDex
    # copy test results
    - ./gradlew testDebugUnitTestCoverage
    - mv app/build/reports/tests/debug $CIRCLE_TEST_REPORTS/AppUnitTests
    - mv app/build/reports/jacoco $CIRCLE_TEST_REPORTS/AppUnitTestsReports

# Only executed if all tasks are successful
deployment:

  # report coverage to coveralls
  coverage:
    branch: [master]
    commands:
    - ./gradlew coveralls --stacktrace